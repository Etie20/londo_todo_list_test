{"version":3,"sources":["../../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport { verify } from 'jsonwebtoken';\r\nimport { SECRET_KEY } from '@config';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\r\nimport userModel from '@models/users.model';\r\n\r\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\r\n    try {\r\n        const Authorization = req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null;\r\n\r\n        if (Authorization) {\r\n            const secretKey: string = SECRET_KEY;\r\n            const verificationResponse = verify(Authorization, secretKey) as DataStoredInToken;\r\n            const userId = verificationResponse._id;\r\n            const findUser = await userModel.findById(userId);\r\n\r\n            if (findUser) {\r\n                req.user = findUser;\r\n                next();\r\n            } else {\r\n                next(new HttpException(401, 'Wrong authentication token'));\r\n            }\r\n        } else {\r\n            next(new HttpException(404, 'Authentication token missing'));\r\n        }\r\n    } catch (error) {\r\n        next(new HttpException(401, `Wrong authentication token`));\r\n    }\r\n};\r\n\r\nexport default authMiddleware;"],"names":["authMiddleware","req","res","next","Authorization","header","split","secretKey","SECRET_KEY","verificationResponse","verify","userId","_id","findUser","userModel","findById","user","HttpException","error"],"mappings":";;;;+BA+BA;;;eAAA;;;8BA9BuB;wBACI;+BACG;mEAER;;;;;;AAEtB,MAAMA,iBAAiB,OAAOC,KAAsBC,KAAeC;IAC/D,IAAI;QACA,MAAMC,gBAAgBH,IAAII,MAAM,CAAC,mBAAmBJ,IAAII,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG;QAEtG,IAAIF,eAAe;YACf,MAAMG,YAAoBC,kBAAU;YACpC,MAAMC,uBAAuBC,IAAAA,oBAAM,EAACN,eAAeG;YACnD,MAAMI,SAASF,qBAAqBG,GAAG;YACvC,MAAMC,WAAW,MAAMC,mBAAS,CAACC,QAAQ,CAACJ;YAE1C,IAAIE,UAAU;gBACVZ,IAAIe,IAAI,GAAGH;gBACXV;YACJ,OAAO;gBACHA,KAAK,IAAIc,4BAAa,CAAC,KAAK;YAChC;QACJ,OAAO;YACHd,KAAK,IAAIc,4BAAa,CAAC,KAAK;QAChC;IACJ,EAAE,OAAOC,OAAO;QACZf,KAAK,IAAIc,4BAAa,CAAC,KAAK,CAAC,0BAA0B,CAAC;IAC5D;AACJ;MAEA,WAAejB"}